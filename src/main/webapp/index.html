<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="robots" content="noindex,nofollow" />
 
<title>書庫管理システム ＜蒼のインプルス＞</title>

		<script language="JavaScript">
		
		var myEditForm;

		
		/**
		 * HTTPリクエスト
		 */
		var httpRequest;

		function callJson(url){
			if(window.XMLHttpRequest){
				httpRequest = new XMLHttpRequest();
			}
			else if ( window.ActiveXObject ){
				httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
			}
			httpRequest.open("GET", url, true);
			httpRequest.onreadystatechange = callback;
			httpRequest.send(null);
		}

		function callback(){
			if(httpRequest.readyState==4){
				if(httpRequest.status==200){
					populateJSON(httpRequest.responseText);
				}
			}
		}

		</script>
</head>
<body style="background-color: #d2b48c">
<h1 style="font-size:0.5em; font-style: normal; ">書庫管理システム ＜蒼のインプルス＞</h1>
<div style="text-align: right;">
 ようこそ○○さん or 
 ログイン
</div>
TODO 11/07/29 : このページが登録書籍の一般ページにします。<br>
ログインが必要な私はここで、ログインをして右にユーザ名がでる！<br>
そして、管理メニューも追加されます。<br>
<br>
<div>
<span style="background-color: #fffacd">本棚</span>
<span style="background-color: #bdb76b">管理メニュー</span>
</div>
<div style="background-color: #deb887">
普通にこのサイトを訪れたら、書籍の一覧が表示されています。<br>
最初は私の本棚と言う意味合い<br>
<style type="text/css">
tabe{
	width:1000px;
}
tr {
	height:250px;
}
td{
	width:250px;
}
div.book{
	position:relative;
	background-color: #f8f8ff;
	width:160px;
	height:180px;
	top:-180px;
	left: 80px;
}
div.cover{
	position:relative;
	left: 10px;
	background-color: #f8f8ff;
	width: 80px;
	height:180px;
}
</style>
<div id="pageStatus"></div>
<table border="2" id="shelf"></table>
<p>書籍情報をメンテします。※登録編集はログイン必要、参照はログイン不要</p>
<a href="userlogin.html?page=hope">ユーザ毎のソーシャル機能（案）</a>(提案中)<br />
<p>ユーザが探している書籍情報を登録します。※　要ログイン</p>
<a href="login.action">蔵書情報ログイン画面 </a>(作成中)<br />
<p>ユーザの所有している書籍情報を登録します。※　要ログイン</p>
管理メニュー<br>
1.自分の書籍を登録する。<br>
2.一般書籍の登録をする<br>
3.画像を管理する<br>
4.パスワードを管理する<br>

今後<br>
検索機能など<br>
</div>
	<script language="JavaScript">
		var pageNo ; 
		function populateJSON(result){
			// jsonの結果を格納します
			var jsonResultObject = eval('('+result+')');
			updateStatus(jsonResultObject);
			var tblShelf = document.getElementById("shelf");
			tblShelf.innerHTML='';
			var nowRow = tblShelf.rows.length;
			if(nowRow==0){
				tblShelf.insertRow(nowRow++);
			}

			for(var i = 0 ; i < jsonResultObject.results.length ; i ++){
				var book = jsonResultObject.results[i];
				var currentRow = tblShelf.rows.item(nowRow-1);
				if(currentRow.cells.length>=4){
					tblShelf.insertRow(nowRow++);
					currentRow = tblShelf.rows.item(nowRow-1);
				}
				var newCell = currentRow.insertCell(0);
				var html="";
				html += '<div style="height:180px">';
				html += '<div class="cover">';
				if(book.imageUrl!=null)
					html += '<img style="width:55px;" src="'+book.imageUrl+'"　/>';
				html += '</div>';
				html += '<div class="book">';
				html += '<div>'+book.title+'</div>';
				html += '<div>著：'+book.author+'</div>';
				html += '<div>ISBN：'+book.barcode+'</div>';
				html += '</div>';
				html += '</div>';

				newCell.innerHTML = html;
			}
		}
		function updateStatus(jsonResultObject){
			// ページングを処理する
			var html = '';
			pageNo = jsonResultObject.pageNo;
			var totalPage = Math.ceil(jsonResultObject.totalCount/jsonResultObject.pageView);
			var isPrePage = !(jsonResultObject.pageNo==1);
			var isNextPage = !((jsonResultObject.pageNo+1)>totalPage);
			if(isPrePage)
				html+=' <a href="#" onclick="onClickPrePage();return false;">前有り</a> ';
			else
				html+=' 前なし ';
			if(isNextPage)
				html+=' <a href="#" onclick="onClickNextPage();return false;">次有り</a> ';
			else
				html+=' 次なし ';
			
			html+='全'+jsonResultObject.totalCount+'件 '; 
			html+=pageNo+'ページ'; 
			html+=' / '+totalPage+'ページ'; 
			html+=' @ '+jsonResultObject.pageView+'件 '; 
			document.getElementById("pageStatus").innerHTML = html;
		}
		
		function onClickPrePage(){
			pageNo--;
			callJson("book.action?pageNo="+pageNo);
		}
		function onClickNextPage(){
			pageNo++;
			callJson("book.action?pageNo="+pageNo);
		}
		callJson("book.action");

		
	</script>

</body>
</html>
